sudo: required

services:
  - docker

env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: L0aAwDP3jaMQXJ4QvHmnr3kAlBQBRtSAi4txm0lfpVZ3JF9f5DNrTWPyDo31s3qNWJ797CqL+kJ8qj2B/G9iy/HKBbUlco8elXp3P4/viWssTpyQJSCggOLfvhLuWStgk3IMbHXhagvSrvJkwaLbnfQEs+2p7EkVxlOBfmWO3qZoqdFv7LSIvxZj8mJbVAnNGPDwWk75emEtIBuvxQNaxeVPwXSvrWp6odwqD8mZE3Wbzn1m6ocq6Ac2sQO54siG3O6tIhVdGIEOdPmGl202Z80fKobA6PgiyrSlG2jPw3+kgXBIj89b2cleG8Pz0JztNY1jUXZDPLcz/kduf/kcRstGJqf9XGWb392goe5EsgvDbuuPlpiX46RwkPSa0vQgP4HiaUSkAcMt5WefazzXcVG1vABHtKpJVq74Bm3x+SfdcW/OugHtOqpSQaLrUBHbnSBuHeSwBwZFX/Y2aCYDPcAJ0wOU7YFE+B+navRpFEd6tZj+q7dR1pWpM75ArYYm7Hs/dMI7Cpe6fbf2owtvVTfH0aCQ7PsmqNrkBHH+LEM9MlJSsWlxrnVkepUqSQWsvwhNSGEXxgQlmMEzOa5ZAQS2+9ACeHhqY7XGeUCHyrqhf1xBO7Bx8ziHU3ILOTd/vpo095GeM7PcySM+AP+B09wxZUwhvVi/eq8yjGSJIiM=
  - secure: rsBrhJiQsp1xxi1l1MfpxZa8a5oMqv89Z/eGQDkZuqULj/MrfDMhWc1BEeyHWRaVS+Gc9wA4Aa4xTpuezrMprOMfMbE0b/HzwPsQg1pxy4WxUhKsxrnjTQoYCYuolSLAeEwfZntwLDB6+EVofWTQWj6eD7/fCIELwzC3awHnDkIDYvu5zZYMbKs2QAnWORa/2MN6ksBmdu5L/R+E+Epyk9JqaYfCcCiDhqMhZds0eyHWDAWARUcLMhUGVk41sqM7uJmHujBQnYyT7yycwTiQ2mpp1u+zRHuhSq7bWRf7EUZjJcxFSSWCGgUahTqGSftrRtbPgRkzsMb0Jg8lKDCtfIBehv220Ixw9AwgBhJwcNTogcF8zjRdvb7kf+o0voIYK+Sahvf1PjWBAU9FFe8aR/3qQ7hX5F2PWp8be9kZAmYEWJcpagimQubrKunXplY+ME8yqkB4LnYoOgdkk9M1e9WIGJAFp78ABnRDUIglY9Aqm/fgZ0+XHiZ8MG7deamfGhwxMvRrQDrik1UCSJGGMCtKuc9O/0OCmgubKHh4NqQ3HTUmjyj30kllPmvT9g69vonnxGo2zUubL0OZrVEaZDFcaBKqxAUhhkK04IE8JM9aftpYU4Tdd5zPiRbDhUooHsdN6jji8Hn4GHRi3tUpPY/BhPxg3Pa8NVLbwLqk8Qc=
  - secure: UtwO0gsNDVCJdEWGwRE9o4xCvwjXJV8DLT19ikMUgUrCAuS0H6ITp7xp51cEb1OMWZA/sBVzCvo/PC8sVElGGUktQYiKgcE6XGZCQHLpiJnMZfIGgQ3UFNRSLl+julwoR6vlOfXbfGupA0Isqj5gXwN3/DaSA90Tx2GoGw+eCm3d2NGhjNcGxPcQ/07S8VyHnNCeUOL4vo0oS4gpfgihvJbdiafxoq+UNlDe754q1yUyqlaLgDhQENsywz9jIYhMLAdRDPUc6/HcW8WgcfVeIRyMTDnnrRr9nSsfaQP9GrPzEKCysUXRpOoh3MZB98OYw9epH5w6NMmJbNIUXtkqo9gUyUx5dWgkuaDRtLr7ubcqfzxRow9PziL1xsXzD2wUknZfxC0PK7wF7R69fRI0xnRSXgJyehZYEd6+zPDdQ1lCtvAT9k13qKrI3E77Qb2ZAZXOl8eV5kwyAHNyDQ7O+3q4QYsHdNPWknLweyxOjt/Y0o2qyvemoyHu6+PpRw2VkbpDU2Fuxd7jQpGT5zxfW2zI2lhagw0LLrA/Rxo0VIKRW+dPPeC2FXL/g8yBhER1fFPdpkQ7X6BMzLu17mejM4F4npp5GDy2SFNIkQqJzjBGVrw/gbHBiZwgZA28e9g/Rx85XCEqWBGju24mifGK9r9xYvoXLkKcj9Bj/uTjhoc=

after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=jeromebreton/nginx-reverse-proxy
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
